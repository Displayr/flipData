## Code Review Guidelines

### R Package Standards
- This is a standard R package - all changes must maintain CRAN-compatible structure
- NAMESPACE is auto-generated by roxygen2 - never edit it directly
- DESCRIPTION must be kept valid with proper versioning
- All exported functions require complete roxygen2 documentation

### Code Style Requirements (enforced by lintr)
- **Naming conventions**: Use `dotted.case`, `camelCase`, or `PascalCase` consistently
  - Parameters/variables: `dotted.case` (e.g., `response.format`, `text.variables`, `api.key`)
  - Functions: `camelCase` or `PascalCase` or `.camelCase` (e.g., `checkInputs`, `MakeOutput`, or `.nestedHelper`)
    - Use `PascalCase` for exported functions (e.g., `AddFormulaBars`, `RegressionTable`)
    - Use `camelCase` for internal/helper functions (e.g., `checkInputs`)
    - Use `.camelCase` for internal nested functions
    e.g., within an internal function
    ```
    addOneToAll <- function(x) {
        .helpAdd <- function(y) {
            y + 1
        }
        vapply(x, .helpAdd, numeric(1L)
    }
    ```
  - Classes/constructors: `CamelCase` (e.g., `OpenAISchema`, `ScalarSchema`)
- **Object name length**: Maximum 50 characters
- **Assignment**: Always use `<-` for assignment, never `=`
- **Pipes**: Use native pipe `|>` for chaining operations
- **NULL coalescing**: Use `%||%` operator for NULL defaults
- **Indentation**: 4 spaces (enforced by lintr)
- **Line length**: Maximum 120 characters (enforced by lintr)
- **No trailing whitespace**

### Function Design Patterns
- **Type checking**: Use helper functions like `isSingleString()`, `isNamedListOrNull()` for validation
- **Error handling**: Use `flipU::StopForUserError()` for user-facing errors with clear, actionable messages
- **Return values**: Functions used for validation/side effects should explicitly return `NULL`
- **Internal functions**: Helper functions should not be exported; use `@noRd` in roxygen comments
- **File organization**: Group related helpers in logical files (e.g., check.inputs.R, tidy.inputs.R)

### Documentation Requirements
- All exported functions must have complete roxygen2 documentation
- Required tags: `@param` (for each parameter), `@return`, `@export`
- Include `@importFrom` for all external package functions used
- Optional but recommended: `@details`, `@examples`

### Testing Requirements
- Use testthat v3 framework (edition 3)
- Test files must be in `tests/testthat/` with `test-` prefix
- Include snapshot tests where appropriate (`_snaps/` directory)
- Tests requiring API keys should use `skip_if()` appropriately

### Import/Dependency Guidelines
- **Never assume libraries are available** - always check existing imports first
- Use explicit `::` notation OR `@importFrom` in roxygen comments
- Check DESCRIPTION for available packages before suggesting new dependencies
- This package uses remotes from Displayr org - respect this pattern

### Security & Best Practices
- **Never log or expose API keys or secrets**

## PR Review Focus Areas
1. **Breaking changes**: Flag any changes to exported function signatures
2. **Documentation**: Ensure all new/modified exports have complete roxygen2 docs
3. **Testing**: Verify new functionality has corresponding tests
4. **Style consistency**: Check adherence to dotted.case, `<-`, `|>` patterns
5. **Error messages**: Ensure user-facing errors are clear and helpful
6. **Dependencies**: Question any new package dependencies
7. **Async patterns**: Verify proper promise/async handling in API calls
8. **NAMESPACE**: Confirm it's auto-generated and not manually edited
9. **Line length**: Flag lines exceeding 120 characters
10. **Object names**: Ensure names don't exceed 50 characters

## Common Issues to Flag
- Using `=` instead of `<-` for assignment
- Missing or incomplete roxygen2 documentation
- Direct API key exposure or logging
- Inconsistent naming conventions (mixing dotted.case/camelCase inappropriately)
- Manual edits to NAMESPACE file
- New dependencies without justification
- Error messages that don't guide users to solutions
- Missing NULL handling with `%||%`
- Line length violations (>120 chars)
- Object names exceeding 50 characters
- Trailing whitespace
